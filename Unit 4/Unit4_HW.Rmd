---
title: "DDS HW4"
author: "Steven Garrity"
date: "9/15/2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
```{r}
library(XML)
library(tidyverse)
library(ggplot2)
```

# Part 1
```{r}
sushi <- read_html("https://d396qusza40orc.cloudfront.net/getdata%2Fdata%2Frestaurants.xml")
sushi_nameR <- html_nodes(sushi,"name")
sushi_name <- stri_sub(sushi_nameR,7,-8)
sushi_zipcodeR <- html_nodes(sushi, "zipcode")
sushi_zipcode <- stri_sub(sushi_zipcodeR,10,-11)
sushi_councilR <- html_nodes(sushi, "councildistrict")
sushi_council <- stri_sub(sushi_councilR,18,-19)

df_sushi <- data.frame(name = sushi_name, zipcode = sushi_zipcode, council=sushi_council)
str(df_sushi)

grep("sushi", ignore.case = TRUE, df_sushi$name)
length(grep("sushi", ignore.case = TRUE, df_sushi$name))
# grepl("sushi", ignore.case = TRUE, df_sushi$name)
# sum(grepl("sushi", ignore.case = TRUE, df_sushi$name))


#### How many sushi restaurants downtown:
df_sushi_11 <- df_sushi %>% filter(council == 11)
length(grep("sushi", ignore.case = TRUE, df_sushi_11$name))
df_sushi_11[grep("sushi", ignore.case = TRUE, df_sushi_11$name),]

sushi_by_council <- df_sushi[grep("sushi", ignore.case = TRUE, df_sushi$name),]

#### How many sushi restaurants in each council:
sushi_by_council_summarize <- sushi_by_council %>% group_by(council) %>% summarize(count = n())

sushi_by_council_summarize$council =
  factor(sushi_by_council_summarize$council,
         level = sushi_by_council_summarize$council[order(as.numeric(as.character(sushi_by_council_summarize$council)))])

sushi_by_council_summarize %>% ggplot(aes(x = council, y = count)) + geom_col() +
  labs(title="Number of Sushi Restaurants by Council District in Baltimore, MD", y="Number of Restaurants", x ="Council")

```

# Part 2
```{r}
# library(openair)

# aurn <- importMeta(source = "aurn")
aurn_detailed <- importMeta(source = "aurn", all = TRUE)

# require(leaflet)

m <- leaflet() %>%
  addTiles() %>% # default OpenStreetMap map tiles
  # addMarkers(lng=aurn_detailed$longitude, lat=aurn_detailed$latitude, popup = aurn_detailed$code)
addCircleMarkers(lng=aurn_detailed$longitude, lat=aurn_detailed$latitude,
    radius = 6,
    color = "green",
    stroke = FALSE, fillOpacity = 0.5,
    popup = aurn_detailed$code)

m

# list all parameters
str(aurn_detailed$parameter)

urban_background_sites <- filter(aurn_detailed, site.type == "Urban Background")
nrow(urban_background_sites)

rural_background_sites <- filter(aurn_detailed, site.type == "Rural Background")
nrow(rural_background_sites)


roch <- importAURN(site= "roch", year = 2018)
str(roch)
bel2 <- importAURN(site = "bel2", year = 2018)
str(roch)

# require(plyr)
alldata = rbind.fill(bel2,roch)
head(alldata)
tail(alldata)
```

# EDA - Step 2
```{r}

```